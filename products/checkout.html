<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>結帳｜阿智小舖</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/rzshop.github.io/assets/styles.css" rel="stylesheet">
</head>
<body>

<!-- ✅ 導覽列 -->
<nav class="navbar navbar-expand-lg bg-dark navbar-dark sticky-top">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/rzshop.github.io/">
      <img src="/rzshop.github.io/assets/images/rzshopp.jpg" alt="" width="28" height="28" class="me-2">
      阿智小舖
    </a>
    <div class="ms-auto text-white">結帳</div>
  </div>
</nav>

<main class="py-4">
  <div class="container" style="max-width:960px">
    <div class="card mb-3">
      <div class="card-header">購物車</div>
      <div class="card-body" id="cartBody">
        <div class="text-center text-muted my-4">載入中...</div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">付款</div>
      <div class="card-body">
        <p>付款成功後，我們將透過 <a href="https://lin.ee/5rGnYqx" target="_blank">LINE 官方帳號</a> 與您聯繫帳號交付。</p>
        <div id="paypal-button-container" class="mt-3"></div>
        <a href="/rzshop.github.io/" class="btn btn-outline-secondary mt-3">← 返回商店</a>
      </div>
    </div>
  </div>
</main>

<footer class="py-4 border-top text-center small">
  <div class="container">© <span id="year"></span> 阿智小舖</div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ===== 購物車核心 ===== */
(function(){
  const CART_KEY = 'rzshop_cart';
  window.Cart = {
    key:CART_KEY,
    get(){try{return JSON.parse(localStorage.getItem(CART_KEY)||'[]');}catch(e){return[];}},
    set(l){localStorage.setItem(CART_KEY,JSON.stringify(l||[]));},
    clear(){localStorage.removeItem(CART_KEY);},
    total(){return this.get().reduce((s,i)=>s+i.price*i.qty,0);}
  };
})();

/* ===== 結帳頁顯示 ===== */
document.addEventListener('DOMContentLoaded',()=>{
  const y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear();
  renderCart();
});

function renderCart(){
  const list = Cart.get();
  const body = document.getElementById('cartBody');
  if(!list.length){
    body.innerHTML = '<div class="alert alert-warning">購物車為空，請返回選購商品。</div>';
    return;
  }
  body.innerHTML = list.map(i=>`
    <div class="row align-items-center py-2 border-bottom">
      <div class="col-2"><img src="/rzshop.github.io/${i.thumbnail}" class="img-fluid rounded"></div>
      <div class="col-6">${i.title}</div>
      <div class="col-2 text-end">$${i.price}</div>
      <div class="col-2 text-end">x${i.qty}</div>
    </div>
  `).join('') + `<div class="text-end fw-bold fs-5 mt-3">合計：$${Cart.total().toFixed(2)}</div>`;
}

/* ===== PayPal ===== */
</script>
<!-- ⚠️ 將下面 CLIENT ID 改成你自己的 Live ID -->
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_LIVE_CLIENT_ID&currency=TWD"></script>
<script>
paypal.Buttons({
  createOrder: (data, actions)=>{
    return actions.order.create({
      purchase_units:[{amount:{value:Cart.total().toFixed(2)}}]
    });
  },
  onApprove: (data, actions)=>{
    return actions.order.capture().then(function(details){
      alert('付款成功，感謝 ' + details.payer.name.given_name + '！');
      Cart.clear();
      location.href='/rzshop.github.io/thankyou.html';
    });
  }
}).render('#paypal-button-container');
</script>
</body>
</html>
