<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>商品詳情｜阿智小舖</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/rzshop.github.io/assets/styles.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg bg-body-tertiary sticky-top shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/rzshop.github.io/">
      <img src="/rzshop.github.io/assets/images/rzshopp.jpg" alt="" width="28" height="28" class="me-2">
      阿智小舖
    </a>
  </div>
</nav>

<header class="py-4 bg-dark text-white">
  <div class="container">
    <h1 class="h4 mb-0">商品詳情</h1>
  </div>
</header>

<main class="py-4">
  <div class="container" id="productContainer">
    <div class="text-center text-muted my-5">載入中…</div>
  </div>
</main>

<footer class="py-4 border-top text-center small">
  <div class="container">© <span id="year"></span> 阿智小舖</div>
</footer>

<script>
document.addEventListener('DOMContentLoaded',()=> {
  const y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear();
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- 統一購物車 -->
<script src="/rzshop.github.io/js/cart.js?v=1"></script>

<script>
(function(){
  const host = '/rzshop.github.io';
  const el = document.getElementById('productContainer');

  function money(n){ return '$' + (Number(n)||0).toFixed(2); }
  function qs(key){ return new URLSearchParams(location.search).get(key); }

  async function loadItem(){
    const id = qs('id');
    if(!id){ el.innerHTML = '<div class="alert alert-danger">缺少商品編號</div>'; return; }

    const res = await fetch(`${host}/data/items.json?ts=${Date.now()}`);
    const items = await res.json();
    const item = items.find(x => String(x.id) === String(id));
    if(!item){ el.innerHTML = '<div class="alert alert-warning">找不到商品</div>'; return; }

    const gallery = Array.isArray(item.gallery) && item.gallery.length ? item.gallery : [item.thumbnail];

    el.innerHTML = `
      <div class="row g-4">
        <div class="col-12 col-lg-6">
          <img id="mainImg" src="${host}/${gallery[0]}" class="img-fluid rounded w-100 mb-3" alt="">
          <div class="d-flex flex-wrap gap-2">
            ${gallery.map((src,i)=>`
              <img src="${host}/${src}" class="img-thumbnail" style="width:88px;height:88px;object-fit:cover;cursor:pointer"
                   data-role="thumb" data-src="${host}/${src}">
            `).join('')}
          </div>
        </div>
        <div class="col-12 col-lg-6">
          <h2 class="h4">${item.title}</h2>
          <div class="text-muted mb-2">${item.id} ｜ ${item.category}</div>
          <div class="fs-4 text-primary mb-3">${money(item.price)}</div>
          <p class="mb-4">${item.description || ''}</p>

          <div class="input-group mb-3" style="max-width:220px">
            <span class="input-group-text">數量</span>
            <input id="qtyInput" type="number" min="1" value="1" class="form-control text-end">
          </div>

          <div class="d-flex flex-wrap gap-2">
            <button id="addBtn" class="btn btn-primary">加入購物車</button>
            <a href="${host}/checkout.html" class="btn btn-outline-secondary">前往結帳</a>
          </div>
        </div>
      </div>
    `;

    // 縮圖切換
    el.querySelectorAll('[data-role="thumb"]').forEach(img=>{
      img.addEventListener('click', ()=>{
        el.querySelector('#mainImg').src = img.dataset.src;
      });
    });

    // 加入購物車
    el.querySelector('#addBtn').addEventListener('click', ()=>{
      const qty = Math.max(1, Number(document.getElementById('qtyInput').value) || 1);
      Cart.add({
        id: item.id,
        title: item.title,
        price: item.price,
        qty,
        thumbnail: item.thumbnail
      });
      const ok = document.createElement('div');
      ok.className = 'alert alert-success mt-3';
      ok.textContent = '已加入購物車！你可以繼續選購或前往結帳。';
      el.appendChild(ok);
      setTimeout(()=> ok.remove(), 2000);
    });
  }

  loadItem();
})();
</script>
</body>
</html>
